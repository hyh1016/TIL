# Item 50. 적시에 방어적 복사본을 만들라

## 자바의 안정성

- C, C++과 같은 저레벨 언어가 아니기 때문에, 버퍼/배열 오버런이나 포인터 메모리 충돌 등으로부터 자유로움
- 하지만 여전히 `외부에 의해 불변이 깨지는 일`은 발생할 수 있음
    - 이는 보안 취약점이 될 수도 있고 개발자의 실수로 인해 클래스가 오작동하게 만들 수 있는 지점이 될 수도 있음

### 불변이 깨지는 예시

- 내부 필드가 불변이 아닌 경우, 이 필드를 파라미터로 제공받아 멤버 변수로 할당한 뒤 외부에서 이 필드 내부의 값을 수정하면 불변이 깨짐
- 이를 예방하기 위해 필드를 초기화하기 전 전달받은 인자를 deep copy한 뒤 할당하는 `방어적 복사`를 이용하는 것이 좋음
- 내부 필드를 클라이언트(외부)에게 제공하는 경우에도 마찬가지. 이를 받아 사용하는 쪽에서 변경을 일으키면 불변이 깨지게 됨
- 하지만 Getter/Setter의 호출 시점마다 복사를 수행하는 것은 메모리 낭비
    - 가장 좋은 방법은 불변이 보장된 클래스들만 멤버 변수로 사용하는 것
        - ex) `Date`는 가변이기 때문에 `LocalDateTime` 등으로 대체

### 방어적 복사를 생략한다면 책임을 클라이언트에게 위임

- 복사에 사용되는 비용이 너무 크거나 하는 이유로 방어적 복사를 생략하고자 하면 아래 두 상황 중 하나에 해당해야 함
    1. 호출자가 내부자(동일 패키지 등)라서 내부를 수정하지 않으리라 확신이 가능한 경우
    2. 가변 객체를 수정한 영향이 오직 클라이언트에게만 가는 경우
