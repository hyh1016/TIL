# Item 85. 자바 직렬화의 대안을 찾으라

## 자바 직렬화의 위험성

- 공격 범위가 넓고 현재에도 더 넓어지고 있음
- ObjectInputStream의 readObject 메서드를 호출하면서 역직렬화됨
    - readObject는 사실상 클래스패스 내 거의 모든 타입의 객체를 생성할 수 있음
    - 이 말은 곧 `생성 가능 타입 내 모든 코드를 수행할 수 있는` 메서드라는 뜻
    - 이 말은 곧 `해당 코드 전체가 공격 범위에 들어간다`는 의미
- 역직렬화 과정에서 호출되어 잠재적 위험을 유발하는 메서드들을 `가젯(gadget)`이라고 부름
    - 여러 가젯을 호출관계로 엮어 가젯 체인을 구성할 수도 있는데, 이를 통해 역직렬화에 걸리는 시간을 무한대에 가깝게 늘림으로써 서비스를 마비시키는 공격도 할 수 있음
- 역직렬화에 오랜 시간이 걸리는 짧은 스트림을 통해 서비스 거부 공격을 할 수도 있음

## 어떻게 위험성에 대처?

### 역직렬화하지 않기

- `신뢰할 수 없는 바이트 스트림`은 역직렬화하지 않으면 됨
- 즉, 직렬화 위험성을 회피하는 가장 좋은 방법은 역직렬화를 안 하는 것
- 현재(2023)에는 `JSON` 등의 공통 포맷을 이용하는 방식이 트렌드이기 때문에, 어차피 잘 쓸 일이 없음

### 역직렬화 필터링을 사용

- 그럼에도 불구하고 레거시를 다루느라 자바 직렬화를 써야 한다면, `역직렬화 필터링`을 사용
- 블랙리스트 방식과 화이트리스트 방식이 존재
    - 블랙리스트: 거부한 것들 이외에는 허용
    - 화이트리스트: 허용한 것들 이외에는 거부
- 화이트리스트 방식을 사용하는 것이 더 좋은데, 그 이유는 `이미 알려진 위협 이외의 잠재적 위협들도 보호할 수 있기 때문`
