# Item 82. 스레드 안정성 수준을 문서화하라

## 스레드 안정성 수준을 문서화

- 메서드의 문서화에는 `해당 메서드를 여러 스레드가 동시에 호출할 때에 대한 동작`이 포함되어 있어야 함
- 클라이언트가 동기화를 해야할지 말지 결정해야 하기 때문

### 스레드 안전성 수준

1. **불변**
    - 상수
    - 동기화가 필요 없음
2. **무조건적 스레드 안전**
    - 수정 가능하지만 내부 동기화가 이루어져 외부 동기화가 필요 없음
    - ex) Atomic class, Concurrent Collections
3. **조건부 스레드 안전**
    - 일부 상황에서는 클라이언트가 동기화해야 함
    - 어떤 순서로 메서드를 호출할 때에는 어떤 락을 얻어야 하는지 명시
    - ex) Collections.synchronized Collections
4. **스레드 안전하지 않음**
    - 수정 가능하며, 클라이언트가 동기화해야 함
    - ex) Collections (ArrayList, HashMap 등)
5. **스레드 적대적**
    - 클라이언트가 동기화해도 스레드 안전하지 않을 수 있음
    - 이런 클래스는 만들면 안 됨
    - 하지만 프로그래머의 실수로 탄생할 수 있으며, 보통 deprecated됨

### 어노테이션으로 표시

- @Immutable = 1. 불변
- @ThreadSafe = 2. 무조건적 스레드 안전
- @NotThreadSafe = 4. 스레드 안전하지 않음
- 보통 문서화할 때에도 1, 2, 4번을 많이 사용

## 그 외 지침

### lock 필드는 final로 선언

- 락 객체가 교체되면 심각한 결과 초래 가능
- 락 필드는 항상 불변이어야 교체를 예방할 수 있음

### 무조건적 스레드 안전 클래스를 작성할 때에는 비공개 락 객체를 이용

- 락 객체가 공개되면 클라이언트 또는 클래스를 상속하는 하위 클래스에서 락을 오남용하여 클래스의 동작을 방해할 수 있음
