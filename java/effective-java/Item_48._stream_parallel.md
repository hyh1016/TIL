# Item 48. 스트림 병렬화는 주의해서 적용하라

## 스트림의 parallel

- 각 스트림 연산을 병렬로 실행되도록 하는 스트림 파이프라인
- 잘못 사용하면 엄청난 부하/성능 저하를 일으킬 수 있음

## 언제 사용?

- 스트림의 소스가 ArrayList, HashMap/HashSet의 인스턴스이거나 정수 배열일 때
    - 데이터를 원하는 크기로 나누기 용이한 자료구조들
    - 원소들에 순차적으로 접근할 때 참조 지역성(locality)이 뛰어남
        - 각 원소들이 메모리 내에 연속적으로 존재한다는 의미
- 종단 연산이 축소(reduction) 연산인 경우
    - min, max, count, sum 등이 이에 해당
    - 하지만 다수 개의 데이터로 합치는 가변 축소 연산의 경우 컬렉션을 합치는 부담이 커 적합하지 않음

## 하지만 사용하지 않는 것을 권장

- 스트림을 잘못 병렬화하면 심각한 성능 저하를 초래하거나 의도하지 않은 결과 데이터를 얻게 될 수 있음
- 그에 반해 스트림을 병렬화했을 때 성능 향상을 누리기 위한 조건은 너무 까다로움
    - 스트림 연산에 관여하는 원소 수와 원소 당 수행되는 코드 수가 수십만 줄 이상이 되어야 최소한의 성능 향상을 누릴 수 있음
- 그리고 스트림을 병렬화하는 것은 어디까지나 최적화 수단이기 때문에, 실제로 최적화가 되었는지 측정해 확신이 있을 때에만 사용해야 함
