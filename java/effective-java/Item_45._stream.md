# Item 45. 스트림은 주의해서 사용하라

## 스트림 API

- 다량의 데이터 처리 작업을 돕고자 Java 8에 도입된 문법
- 스트림은 두 가지 개념(스트림, 스트림 파이프라인)으로 구성

### 스트림

- 데이터 원소의 유/무한 시퀀스

### 스트림 파이프라인

- 스트림의 원소들로 수행하는 연산 단계를 표현하는 개념식
- 소스 스트림(최초 데이터)으로부터 시작해 종단 연산으로 끝남
- 파이프라인은 하나 이상의 중간 연산으로 구성되며 각 연산을 거치며 다른 스트림으로 변환

## 스트림의 지연 평가(lazy evaluation)

- 스트림의 평가는 종단 연산이 호출될 때 이루어짐
- 즉, 종단 연산에 쓰이지 않는 원소는 계산에 쓰이지 않음
    - 소스 스트림이 무한이어도 종단 연산에 사용되는 데이터가 유한 개이면 문제가 없다는 뜻

## 스트림 API는 Fluent API

```java
list
	.map((element) -> ...) // 중간 연산
	.filter((element) -> ...) // 중간 연산
	.forEach((element) -> ...);
```

- 중간 연산은 스트림을 반환하기 때문에, 모든 연산을 연결하여 단 하나의 표현식으로 나타낼 수 있음

## 스트림 vs 반복문

- 둘 중 어느 한 쪽이 좋다고 확정짓기 어려움
- 그때그때 둘 다 사용해 나타내보고, 더 좋은 쪽을 선택
- 중첩 반복문인 경우 일부만 스트림으로 전환하는 쪽이 가장 좋은 방법일 수도 있음

### 반복문을 사용해야 할 때 (스트림 사용이 불가능)

- 로직 내에서 지역변수에 접근해야 하는 경우
    - 람다는 final 변수에 접근하는 것만 가능하며, 지역변수를 읽거나 수정하는 것은 불가능
- 람다에서는 return/break/continue가 불가능
    - 즉, 중간에 흐름을 임의로 제어하거나 끊는 것이 불가능하며 이러한 동작이 필요하다면 반복문을 이용해야 함

### 스트림을 사용하면 좋은 경우

- 원소들의 시퀀스를 일관되게 변환
- 시퀀스를 특정 조건에 따라 필터링
- 시퀀스를 하나의 연산을 적용해 결합
