# Volume vs Bind Mount

## Volume

- 컨테이너에서 사용되거나 생성되는 영속성 데이터를 다루는 기술
- 데이터는 도커 엔진에 의해 관리됨 (도커의 관리 영역)
- 사용 방식은 Anonymous Volume과 Named Volume으로 나뉨
    - Anonymous Volume: 우리가 이름을 직접 지정하지 않으며, 이름이 자동으로 부여됨
    - Named Volume: 우리가 직접 이름을 지정

### Anonymous Volume 사용

```java
docker run ...
	-v {컨테이너 내부 경로}
```

- 특정 컨테이너 내부 경로의 데이터를 영속화함
- `--rm` 옵션과 함께 사용하는 경우 컨테이너를 종료할 때 익명 볼륨도 함께 제거됨

### Named Volume 생성 및 사용

```java
docker run ...
	-v {볼륨명}:{컨테이너 내부 경로}
```

- 익명 볼륨과의 차이는, 볼륨명을 직접 지정해준다는 것
- `--rm` 옵션과 함께 사용해도 볼륨이 제거되지 않음

### 볼륨 목록 확인

```java
docker volume ls
```

- 익명 볼륨도 제거되지 않았다면 여기서 확인 가능
    - 하지만 익명 볼륨은 이 볼륨에 어떤 데이터가 담기는지 식별하기 어려우므로 재사용이 어려움
    - 그래서 일반적으로 컨테이너와 생명주기를 같이 하도록 사용하는 편이며, 그렇지 않아야 하는 경우(여러 컨테이너에서 재사용해야하는 경우) 명명 볼륨을 사용하는 것이 좋음
- 볼륨은 여러 컨테이너에 연결 가능
    - 볼륨의 목적 중 하나. 컨테이너 간 데이터 공유를 쉽게 할 수 있도록 함

## Bind Mount

- 호스트 내의 파일/디렉토리가 컨테이너의 파일/디렉토리에 마운트되는 것
- 데이터는 호스트 기기의 파일시스템에 의해 관리됨

### `-v` 또는 `--volume` 옵션을 통한 사용

```java
docker run ...
	-v {호스트 파일/디렉토리 경로}:{컨테이너 파일/디렉토리 경로}
```

- 마운트는 볼륨과 동일한 옵션값으로도 사용할 수 있음

### `-m` 또는 `--mount` 옵션을 통한 사용

```java
docker run ...
	-m type=bind,source={호스트 파일/디렉토리 경로},target={컨테이너 파일/디렉토리 경로}
```

- key=value 형식으로 옵션을 지정할 수 있으며 컴마(,)로 구분
- 호스트 파일/디렉토리 경로가 없는 경우 -v는 생성하고, -m은 에러를 발생시킴

## Volume vs Bind Mount

![Volume vs Bind Mount](https://docs.docker.com/storage/images/types-of-mounts-volume.webp?w=450&h=300)

- 두 가지 모두 데이터 영속화를 위해 사용되는 기법
    - 즉, 컨테이너가 종료되어도 데이터가 유실되지 않도록 하는 것이 목적
- 물리적으로는 둘 다 호스트 기기의 파일시스템에 존재하는 것이나, 논리적으로 볼륨은 ‘도커가 관리하는 별도 영역’에 존재
    - 이로부터 발생하는 가장 큰 차이점은, **볼륨 영역은 Docker CLI를 사용할 수 있다**는 것
        - 볼륨을 생성하거나, 삭제하거나, 조회할 수 있음
    - 마운트는 호스트 내 경로를 사용하는 것이므로 도커의 관리를 받을 수 없음
- 도커가 관리하는 별도 영역은 내 데이터는 호스트에서 보기에는 어려움
    - 따라서, 만약 컨테이너가 아닌 **호스트에서도 영속 데이터를 읽거나 수정하고자 하는 경우 마운트 방식을 이용**해야 함
        - 도커 컨테이너가 아닌 또다른 프로그램으로 이 데이터를 제어하고자 하는 경우 등
        - 대표적 예시로 DB 데이터를 마운트하여 영속화하고 별도 DB 관리 도구를 통해 데이터를 확인하고자 하는 경우가 있음

## 요약

- 볼륨은 데이터를 도커의 관리 영역에 영속화하는 것
- 볼륨을 이용하면 Docker CLI를 이용하는 등 도커의 관리를 받을 수 있다는 이점이 존재
- 마운트는 데이터를 호스트의 관리 영역에 영속화하는 것
- 도커 컨테이너 이외의 다른 도구에서도 영속화된 데이터에 접근하고자 한다면 마운트 방식을 이용
