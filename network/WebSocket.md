# π€ WebSocket

## λ“±μ¥ λ°°κ²½

HTTP ν”„λ΅ν† μ½μ„ μ΄μ©ν• ν†µμ‹ μ€ κΈ°λ³Έμ μΌλ΅ λ‹¨λ°©ν–¥μ΄λ‹¤. `Clientλ΅λ¶€ν„° μƒμ„±λ Request Packetμ΄ μ„λ²„μ—κ² μ „λ‹¬λλ©΄, μ„λ²„λ” μ΄μ— λ€ν• Reseponse Packetμ„ μ κ³µν•λ” λ°©μ‹`μΌλ΅ ν†µμ‹ μ΄ μ΄λ£¨μ–΄μ§„λ‹¤.

μ΄λ¬ν• λ‹¨λ°©ν–¥ ν†µμ‹ μ λ‹¨μ μ€ μ„λ²„μ— λ³€ν™”κ°€ μλ”λΌλ„, `λ°λ“μ‹ ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­μ„ ν•΄μ•Ό ν•΄λ‹Ή λ³€ν™”λ¥Ό ν™•μΈν•  μ μλ‹¤`λ” κ²ƒμ΄λ‹¤. `μ›Ήμ†μΌ“`μ€ μ„λ²„κ°€ `μ”μ²­ μ—†μ΄λ„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μ΄ν„°λ¥Ό μ „μ†΅`ν•  μ μλ„λ΅ `μ–‘λ°©ν–¥ ν†µμ‹  ν™κ²½μ„ μ κ³µ`ν•¨μΌλ΅μ¨ μ΄λ¬ν• λ‹¨μ μ„ ν•΄κ²°ν•λ‹¤.

## WebSocket (μ›Ήμ†μΌ“)

### μ •μ

μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„ μ–‘λ°©ν–¥ ν†µμ‹ μ„ μ„ν• `ν”„λ΅ν† μ½`

`ws://`λ΅ μ‹μ‘ν•λ©°, TCP/IP κΈ°λ°μΌλ΅ λ™μ‘ν•λ‹¤.

### λ™μ‘ μ›λ¦¬

1. **ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² ν•Έλ“μ‰μ΄ν‚Ή(websocket μ—°κ²°μ„ μ„ν• ν‘μƒ)μ— ν•΄λ‹Ήν•λ” HTTP μ”μ²­ μ „μ†΅**
    
    ```sql
    GET /chat HTTP/1.1
    Host: example.com:8000
    Upgrade: websocket
    Connection: Upgrade
    Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
    Sec-WebSocket-Version: 13
    ```
    
    - `HTTP 1.1` μ΄μƒμ λ²„μ „μ„ μ‚¬μ©ν•΄μ•Ό ν•¨
    - HTTP λ©”μ†λ“λ” λ°λ“μ‹ `GET`
    - `Upgrade: websocket` ν—¤λ”λ¥Ό ν¬ν•¨
    - `Connection: Upgrade` ν—¤λ”λ¥Ό ν¬ν•¨
    - ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ κ°„ μΈμ¦μ„ μ„ν• `Sec-WebSocket-Key` ν—¤λ”λ¥Ό ν¬ν•¨
    - μ„λ²„κ°€ μ›Ήμ†μΌ“ λ²„μ „μ„ μΈμ‹ν•  μ μ—†λ” κ²½μ° λ²„μ „ λ…μ‹λ¥Ό μ„ν•΄ `Sec-WebSocket-Version` ν—¤λ”λ¥Ό ν¬ν•¨

2. **μ„λ²„λ” 1λ² μ”μ²­μ— λ€ν• μ‘λ‹µμ„ μ „μ†΅**
    
    ```sql
    // Success
    HTTP/1.1 101 Switching Protocols
    Upgrade: websocket
    Connection: Upgrade
    Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
    ```
    
    - μ΄μ λ¶€ν„° μ›Ήμ†μΌ“ ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•  κ²ƒμ΄λΌλ” μƒνƒ μ½”λ“ `101`μ„ μ‚¬μ©
    - λ§μ°¬κ°€μ§€λ΅ `Upgrade`, `Connection` ν—¤λ”λ¥Ό ν¬ν•¨
    - ν΄λΌμ΄μ–ΈνΈμ `Sec-WebSocket-Key` κ°’μ„ [λ§¤μ§ μ¤νΈλ§](https://en.wikipedia.org/wiki/Magic_string)κ³Ό μ΄μ–΄ λ¶™μ΄κ³  SHA-1 ν•΄μ‹ μ•κ³ λ¦¬μ¦μΌλ΅ μ•”νΈν™”ν•κ³  base64λ΅ μΈμ½”λ”©ν• κ°’μ„ λ‹΄μ€ `Sec-WebSocket-Accept` ν—¤λ”λ¥Ό ν¬ν•¨
    
    ```sql
    // Fail
    HTTP/1.1 400 Bad Request
    ```
    
    - λ§μ•½ μ—°κ²°μ— μ‹¤ν¨ν–λ‹¤λ©΄ μ„λ²„λ” μ¦‰μ‹ `400`μ„ λ°ν™ν•κ³  μ¦‰μ‹ μ†μΌ“μ„ μΆ…λ£ν•΄μ•Ό ν•¨

3. **μ„±κ³µμ μΌλ΅ ν”„λ΅ν† μ½μ΄ μ›Ήμ†μΌ“(ws)μΌλ΅ λ³€κ²½λ κ²½μ°, μ΄μ  μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλ” μ–Έμ λ“  λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•  μ μλ‹¤. (μ¦‰, μ–‘λ°©ν–¥ ν†µμ‹ μ„ ν•  μ μλ‹¤.)**
