# L4 로드밸런서와 L7 로드밸런서의 차이점

## L4 Load Balancer

### 정의

- 전송 계층(Transport Layer)의 정보를 바탕으로 트래픽을 분산
    - 출발지/목적지의 IP, Port
- 장점
    - 빠르고, 저렴
- 단점
    - 세부적 라우팅은 불가능

### 언제 사용?

- L7 정도로 세부 설정이 필요 없고, 대량의 트래픽을 처리해야 하는 경우
- L7의 경우 HTTPS로 받으면 패킷 데이터를 복호화 해야 하는데, 보안상의 이유로 이게 어려울 때

## L7 Load Balancer

### 정의

- 애플리케이션 계층(Application Layer)의 정보를 바탕으로 트래픽을 분산
    - HTTP 패킷 내 데이터 (Header/Payload, Cookie, URI path, Query String 등)
- 장점
    - 정교한 라우팅
- 단점
    - L4에 비해 느림

### 언제 사용?

- HTTP 패킷 내 데이터 기반의 정교한 라우팅이 필요할 때
- 사용자 인증 정보(쿠키, 세션 등)를 기반으로 Sticky Session이 필요할 때
- 비정상적 요청을 차단하고 싶을 때

### L7 + 인증서

- L7 로드밸런서에는 인증서를 등록해 클라이언트와의 HTTPS 통신을 수행하도록 할 수 있음
- 이 경우 LB - 타겟 서버 간 통신이 내부망에서 이루어진다면 LB - 서버 간 통신은 HTTP로 하여 서버의 복호화 부담을 덜어줄 수 있음
- 또한, LB 뒤에 다수 대의 서버가 있을 때 LB로 인증서 관리를 단일화할 수도 있느 것

## 왜 L5/L6는 없을까?

- '가성비가 좋지 않다'
- L5(세션 유지를 위한 레이어)와 L6(데이터 변환 및 암호화, 압축 레이어)에서 하는 작업들을 하려면 결국 데이터 내용물을 까 보아야 함
- 그럴 거면 L7을 쓰는게 더 많은 일을 할 수 있으니 더 효율적
